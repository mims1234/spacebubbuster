<!DOCTYPE html>

<head>
	<title>Bouncing Space Balls</title>
	<meta name="viewport" content="width=device-width, user-scalable=no">
	</script>
	<style>
		.demo_page {
			background: #a9adb0 url(../bg.jpg) no-repeat center top;
			background-image: url('assets/game.png');
			color: #333;
			font-family: Arial, Helvetica, sans-serif;
			font-size: 12px;
		}

		.demo_content {
			margin: 0 auto;
			text-align: center;
			width: 400;
		}

		.info {
			margin: 15px 0;
		}
	</style>
</head>


<body class="demo_page">
	<audio src="assets/sound.mp3" id="sound"></audio>
	<div class="demo_content">

		
		<div class="info">
			<script src="https://cdnjs.cloudflare.com/ajax/libs/seedrandom/3.0.5/seedrandom.min.js"></script>
			<script type="text/javascript">
				(function celerxfunc() {
					function binary_to_base64(e) {
						for (var t = new Uint8Array(e), r = new Array, n = 0, i = 0, a = new Array(3), o = new Array(4), s = t.length, d = 0; s--;)
							if (a[n++] = t[d++], 3 == n) {
								for (o[0] = (252 & a[0]) >> 2, o[1] = ((3 & a[0]) << 4) + ((240 & a[1]) >> 4), o[2] = ((15 & a[1]) << 2) + ((192 & a[2]) >> 6), o[3] = 63 & a[2], n = 0; n < 4; n++) r += base64_chars.charAt(o[n]);
								n = 0
							} if (n) {
								for (i = n; i < 3; i++) a[i] = 0;
								for (o[0] = (252 & a[0]) >> 2, o[1] = ((3 & a[0]) << 4) + ((240 & a[1]) >> 4), o[2] = ((15 & a[1]) << 2) + ((192 & a[2]) >> 6), o[3] = 63 & a[2], i = 0; i < n + 1; i++) r += base64_chars.charAt(o[i]);
								for (; n++ < 3;) r += "="
							}
						return r
					}

					function dec2hex(e) {
						for (var t = hD.substr(15 & e, 1); e > 15;) e >>= 4, t = hD.substr(15 & e, 1) + t;
						return t
					}

					function base64_decode(e) {
						var t, r, n, i, a, o, s, d = new Array,
							c = 0,
							l = e;
						if (e = e.replace(/[^A-Za-z0-9\+\/\=]/g, ""), l != e && alert("Warning! Characters outside Base64 range in input string ignored."), e.length % 4) return alert("Error: Input length is not a multiple of 4 bytes."), "";
						for (var u = 0; c < e.length;) i = keyStr.indexOf(e.charAt(c++)), a = keyStr.indexOf(e.charAt(c++)), o = keyStr.indexOf(e.charAt(c++)), s = keyStr.indexOf(e.charAt(c++)), t = i << 2 | a >> 4, r = (15 & a) << 4 | o >> 2, n = (3 & o) << 6 | s, d[u++] = t, 64 != o && (d[u++] = r), 64 != s && (d[u++] = n);
						return d
					}
					var _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) {
						return typeof e
					} : function (e) {
						return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
					},
						bridge = {
							default: void 0,
							call: function (e, t, r) {
								var n = "";
								if ("function" == typeof t && (r = t, t = {}), t = {
									data: void 0 === t ? null : t
								}, "function" == typeof r) {
									var i = "dscb" + window.dscb++;
									window[i] = r, t._dscbstub = i
								}
								return t = JSON.stringify(t), window._dsbridge ? n = _dsbridge.call(e, t) : (window._dswk || -1 != navigator.userAgent.indexOf("_dsbridge")) && (n = prompt("_dsbridge=" + e, t)), JSON.parse(n || "{}").data
							},
							register: function (e, t, r) {
								r = r ? window._dsaf : window._dsf, window._dsInit || (window._dsInit = !0, setTimeout(function () {
									bridge.call("_dsb.dsinit")
								}, 0)), "object" == (void 0 === t ? "undefined" : _typeof(t)) ? r._obs[e] = t : r[e] = t
							},
							registerAsyn: function (e, t) {
								this.register(e, t, !0)
							},
							hasNativeMethod: function (e, t) {
								return this.call("_dsb.hasNativeMethod", {
									name: e,
									type: t || "all"
								})
							},
							disableJavascriptDialogBlock: function (e) {
								this.call("_dsb.disableJavascriptDialogBlock", {
									disable: !1 !== e
								})
							}
						};
					! function () {
						if (!window._dsf) {
							var e, t = {
								_dsf: {
									_obs: {}
								},
								_dsaf: {
									_obs: {}
								},
								dscb: 0,
								celerx: bridge,
								close: function () {
									bridge.call("_dsb.closePage")
								},
								_handleMessageFromNative: function (e) {
									var t = JSON.parse(e.data),
										r = {
											id: e.callbackId,
											complete: !0
										},
										n = this._dsf[e.method],
										i = this._dsaf[e.method],
										a = function (e, n) {
											r.data = e.apply(n, t), bridge.call("_dsb.returnValue", r)
										},
										o = function (e, n) {
											t.push(function (e, t) {
												r.data = e, r.complete = !1 !== t, bridge.call("_dsb.returnValue", r)
											}), e.apply(n, t)
										};
									if (n) a(n, this._dsf);
									else if (i) o(i, this._dsaf);
									else if (n = e.method.split("."), !(2 > n.length)) {
										e = n.pop();
										var n = n.join("."),
											i = this._dsf._obs,
											i = i[n] || {},
											s = i[e];
										s && "function" == typeof s ? a(s, i) : (i = this._dsaf._obs, i = i[n] || {}, (s = i[e]) && "function" == typeof s && o(s, i))
									}
								}
							};
							for (e in t) window[e] = t[e];
							bridge.register("_hasJavascriptMethod", function (e, t) {
								return t = e.split("."), 2 > t.length ? !(!_dsf[t] && !_dsaf[t]) : (e = t.pop(), t = t.join("."), (t = _dsf._obs[t] || _dsaf._obs[t]) && !!t[e])
							})
						}
					}();
					var base64_chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",
						hD = "0123456789ABCDEF",
						keyStr = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";
					window.celerx = {
						onStateReceived: function (e) {
							return bridge.register("onStateReceived", function (t) {
								var r = base64_decode(t);
								return e(new Uint8Array(r))
							})
						},
						onCourtModeStarted: function (e) {
							return bridge.register("onCourtModeStarted", e)
						},
						getMatch: function () {
							var e = bridge.call("getMatch", "123");
							try {
								e = JSON.parse(e)
							} catch (e) { }
							return e
						},
						showCourtModeDialog: function () {
							return bridge.call("showCourtModeDialog")
						},
						start: function () {
							return bridge.call("start")
						},
						sendState: function (e) {
							return bridge.call("sendState", binary_to_base64(e))
						},
						draw: function (e) {
							return bridge.call("draw", binary_to_base64(e))
						},
						win: function (e) {
							return bridge.call("win", binary_to_base64(e))
						},
						lose: function (e) {
							return bridge.call("lose", binary_to_base64(e))
						},
						surrender: function (e) {
							return bridge.call("surrender", binary_to_base64(e))
						},
						applyAction: function (e, t) {
							return bridge.call("applyAction", binary_to_base64(e), t)
						},
						getOnChainState: function (e) {
							return bridge.call("getOnChainState", "123", function (t) {
								var r = base64_decode(t);
								return e(new Uint8Array(r))
							})
						},
						getOnChainActionDeadline: function (e) {
							return bridge.call("getOnChainActionDeadline", "123", e)
						},
						getCurrentBlockNumber: function () {
							return bridge.call("getCurrentBlockNumber", "123")
						},
						finalizeOnChainGame: function (e) {
							return bridge.call("finalizeOnChainGame", "123", e)
						},
						submitScore: function (e) {
							return bridge.call("submitScore", e)
						}
					};
				})();
				//Game Starts

				var match = celerx.getMatch(); 
				// Math.seedrandom(match && match.sharedRandomSeed, { global: true });
				celerx.start()
				
				window.addEventListener('load', init, false);
				
				var canvas;
				var score = 0;
				var ctx;
				var speed = 1;
				var canvasX = [];
				var canvasY = [];
				var mouseIsDown = 0;
				var bubble = [];
				var len = 0;
				var colors = ['#fc0000', '#fce700', '#02b045', '#c806cf']
				var sound= document.getElementById('sound')

				var health = 25;

				function init() {
					canvas = document.getElementById("canvas");
					ctx = canvas.getContext("2d");
					sound.play()

					canvas.addEventListener("mousedown", mouseDown, false);
					canvas.addEventListener("mousemove", mouseXY, false);
					canvas.addEventListener("touchstart", touchDown, false);
					canvas.addEventListener("touchmove", touchXY, true);
					canvas.addEventListener("touchend", touchUp, false);

					document.body.addEventListener("mouseup", mouseUp, false);
					document.body.addEventListener("touchcancel", touchUp, false);

					//Initially create bubble here
					for (i = 0; i < 10; i++) {
						//set the initial position for each bubble
						bubble[i] = 700;
					}
					runGame();
				}

				function mouseUp() {
					mouseIsDown = 0;
					mouseXY();
				}

				function touchUp() {
					mouseIsDown = 0;
					len = e.targetTouches.length;
				}

				function mouseDown() {
					mouseIsDown = 1;
					mouseXY();
				}

				function touchDown() {
					mouseIsDown = 1;
					touchXY();
				}

				function mouseXY(e) {
					e.preventDefault();
					canvasX[0] = e.pageX - canvas.offsetLeft;
					canvasY[0] = e.pageY - canvas.offsetTop;
					len = 1;
				}

				function touchXY(e) {
					e.preventDefault();
					len = e.targetTouches.length;
					for (i = 0; i < len; i++) {
						canvasX[i] = e.targetTouches[i].pageX - canvas.offsetLeft;
						canvasY[i] = e.targetTouches[i].pageY - canvas.offsetTop;
					}
				}

				function healthDisplay() {
					//health
					ctx.fillStyle='#FFFFFF';
					ctx.font = "bold 24px Arial";
					ctx.fillText("Life Remaining:" + health, 80, 100);
				}

				function ScoreDisplay() {
					//health
					ctx.fillStyle='#FFFFFF';
					ctx.font = "bold 24px Arial";
					ctx.fillText("Score:" + score, 80, 60);
				}

				function gameOverDisplay() {
					ctx.fillStyle = "rgba(255, 255, 255, 1)";
					ctx.font = "bold 24px Arial";
					ctx.fillText(`Game Over, High Score = ${score}`, 80, 100);
				}

				function runGame() {
					ctx.fillStyle = "rgba(255, 255, 255, 0.3)";
					ctx.clearRect(0, 0, canvas.width, canvas.height);

					if (health <= 0) {
						gameOverDisplay();
						celerx.submitScore(score) 
					} else {
						for (i = 0; i < 10; i++) {
							bubble[i] = bubble[i] - (1 * speed);
							if (bubble[i] <= canvas.height - 580) {
								bubble[i] = 700;
								health -= 1;
							}

							var y = bubble[i];
							var x = (i + 1) * 50;
							var radius = 25;
							ctx.beginPath();
							ctx.arc(x, y, radius, 0, 2 * Math.PI);
							colvar = Math.round(Math.random() * 10);
							ctx.fillStyle = `#${colvar}${colvar}${colvar}${colvar}${colvar}${colvar}`;
							
							ctx.closePath();

							// Detect Mouse Moves
							for (j = 0; j < len; j++) {
								if (ctx.isPointInPath(canvasX[j], canvasY[j]) && mouseIsDown) {
									if (score % 10 === 0 && score > 10) speed += (0.00001 * 22000)
									if (score % 50 === 0 && score > 50) health += 5;
									score += 1
									bubble[i] = 700;
								}
							}
							ctx.fill();
							ScoreDisplay();
							healthDisplay();
						}

						setTimeout("runGame()", 20);
					}
				}celerx.submitScore(score);

				
			</script>
			<canvas id="canvas" height="700" width="600" style="background: url(bg.jpg) no-repeat 0 0;">
				Sorry, your browser doesn't support canvas technology.
			</canvas>
		</div>
	</div>
</body>

</html>